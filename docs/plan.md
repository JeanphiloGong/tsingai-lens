# LLM 文献学习与参数洞察项目规划（迭代版）

背景：在现有 TsingAI-Lens（文档上传、切片、向量化、关键词/图谱/思维导图、RAG 问答）的基础上，按客户新增诉求迭代，目标在 2 个月内完成可用版本，用于大规模文献“自学-扩展-洞察”。

## 目标与范围
- 目标：让系统先学会提供的文献与 Excel 知识，再自动扩展万级文献并学习，最终围绕给定特征 A 输出影响因素排序与可视化，同时支持表格/数据抽取。
- 成果：API + 前端可视化（点云/知识图谱）+ 配套数据/模型管线；提供操作手册与可验证的示例用例。
- 不含：下游预测/拟合模型训练（用户自建），但需输出可供该步骤使用的特征列表与数据整理结果。

## 需求拆解
1) 内部知识学习：导入提供的文献与 Excel，抽取领域概念、工艺参数、关键术语，建立可检索的基础知识库。  
2) 外部文献检索：根据已有概念/关键词/DI（数字标识符），自动抓取/补充文献元信息与正文（PDF/HTML）；生成可追溯的“DI → 来源链接/PDF”清单。  
3) 扩展学习与去重：对新增万级文献做去重、切片、向量化、摘要/关键词/图谱抽取，维护增量索引。  
4) 特征影响分析：给定特征 A，生成“影响因素 → 重要性/权重/关联方向”排序，输出知识图谱/点云 JSON 及摘要。  
5) 表格/数据抽取：从文献正文/附录/表格中提取结构化数据（CSV/Parquet），对齐字段含义与单位，形成可用数据集。  
6) 评估与可视化：提供检索/抽取/影响分析的质量指标与前端展示（含交互式过滤与溯源）。

## 阶段式推进（无具体日期）
- 阶段 0（当前基线）  
  - 现有能力：上传/切片/向量库、关键词/图谱/思维导图、RAG 问答。

- 阶段 1：最小 MVP（优先完成）  
  - 目标：仅针对 PDF 完成端到端链路——解析 → 切片/索引 → 根据给定指标（特定特征 A）返回相关的实验方法/流程描述。  
  - 输出：  
    - API：`POST /documents` 已有；新增/复用查询接口，支持 `query=<特定指标>`，返回匹配片段及来源页码/段落。  
    - 解析：PDF 文本提取（保持页码/段落位置信息），基础表格/图片占位标记。  
    - 筛选：基于检索（向量/关键词）聚焦“实验方法/工艺流程”相关段落；可用 LLM 做二次过滤。  
    - 返回格式：`{answer, sources: [{doc_id, page, snippet, score}]}`，确保溯源。  
  - 验收：给定一个指标（例：特征 A），能返回 3-5 条实验方法片段，含页码/段落定位。
  - 阶段 1 实施拆解（便于多人并行）：  
    - PDF 解析与页码保留（Owner A）  
      - 在 `loader` 中按页返回文本，保留页码/段落分隔；继续生成图片占位。  
      - 交付：`[(page_no, text)]` 与 images manifest，覆盖常见 PDF。  
    - 切片与元数据（Owner B）  
      - Chunker 支持按页文本输出 `[(chunk_text, {doc_id, source, page, chunk_id})]`。  
      - 上传接口写入带页码/chunk_id 的 metadata，便于检索溯源。  
      - 交付：向量库中每条向量包含 `doc_id/source/page/chunk_id`。  
    - 检索与得分（Owner C）  
      - VectorService 增加带得分检索接口；`dump_sources` 返回 `doc_id/page/chunk_id/snippet/score/source`。  
      - 交付：`/query` 返回含得分与页码的 sources。  
    - “实验方法/流程”二次过滤（Owner D）  
      - 先取 TopK，再用关键词规则（如“实验/方法/步骤/procedure/apparatus”）+ LLM 判定筛选 3-5 条方法/流程段落。  
      - 提示词强调仅基于实验方法/流程作答。  
      - 交付：过滤函数/调用接入 `/query`，可独立开关。  
    - 返回格式与验收脚本（Owner E）  
      - `/query` 统一输出 `{answer, sources:[{doc_id, page, snippet, score, source}]}`。  
      - 准备 curl 示例与验收清单：上传 sample.pdf，使用 `query="特征A"`，检查 sources 段落页码与数量（3-5 条）。  
      - 交付：文档化使用步骤 + 示例响应。  
    - 集成验证（Owner F）  
      - 本地跑 `uvicorn main:app --reload`；执行上传/查询自测，截图或记录响应。  
      - 交付：通过验收标准的测试记录。

- 阶段 2：外部检索与扩展学习  
  - 接入 DI/关键词检索 Provider（可 Mock）；批量抓取 PDF/元数据，去重后增量索引。  
  - 质量监控：覆盖率、去重率。

- 阶段 3：表格/数据抽取与特征影响分析  
  - 表格检测→CSV/Parquet；字段标准化。  
  - 特征 A 影响因素排序：关系抽取/共现统计/LLM 评分混合；输出图谱/点云 JSON。

- 阶段 4：稳健性与交付  
  - 批处理队列、监控、操作手册、示例用例与验证报告。

## 技术方案（对现有能力的扩展）
- 抽取/总结：继续使用现有 LLMClient；引入批处理与长度控制，支持“仅摘要/仅关键词/仅关系抽取”模式以节省 token。  
- 外部检索：定义统一 Provider 接口（DI/关键词 → {title, authors, year, link, pdf_url}）；先用离线样例/Mock，后可接学术检索 API 或定制爬虫。  
- 去重与合并：基于标题+DOI/DI+摘要指纹（MinHash/BLEU）做去重；增量写入向量库。  
- 表格抽取：优先用 PDF 表格检测 + LLM 校正；输出 CSV/Parquet，并记录字段含义/单位。  
- 影响分析：结合关系抽取（LLM）+ 共现统计 + 引文/频次得分，加权排序；输出图谱 JSON 与可视化配置。  
- 可视化：前端基于现有图谱/思维导图 JSON 增加点云/权重显示；保留溯源链接（文献 ID/DI/页码/片段）。

## 交付物
- 后端：新增外部检索、批处理管线、表格抽取、影响分析 API；任务/日志/指标接口。  
- 前端：上传/检索/可视化页面，点云/图谱交互过滤，任务进度与质量指标展示。  
- 数据与配置：示例文献/Excel、字段映射、抽取/检索/去重配置模板。  
- 文档：API 文档、操作手册、质量评估报告、上线检查清单。

## 风险与缓解
- 外部检索合规与网络可达性：先 Mock 与离线数据，后置接入真实源；提供速率/黑名单配置。  
- LLM 成本与质量：拆分任务、控制上下文长度、缓存摘要/图谱结果；必要时引入本地模型。  
- 去重/字段对齐误差：引入抽样标注与指标，支持人工覆核通道。  
- 时限风险：按里程碑逐步可用，每周交付可运行版本，提前锁定示例用例验证链路。
